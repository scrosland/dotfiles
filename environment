#
# vim: set filetype=sh:
#
# Environment
#

if uname -a | grep -q -s Microsoft ; then
    WSL=$(uname -r) ; export WSL
fi

_sc_select_browser()
{
    if [ -x /usr/bin/open ] ; then
        echo /usr/bin/open
    elif [ -n "${DISPLAY}" ] ; then
        if [ -n "${GNOME_DESKTOP_SESSION_ID}" -a -x /usr/bin/gnome-open ] ; then
            echo /usr/bin/gnome-open
        elif [ -x /usr/bin/x-www-browser ] ; then
            echo /usr/bin/x-www-browser
        elif [ -x /usr/bin/xdg-open ] ; then
            echo /usr/bin/xdg-open
        fi
    fi
}

BROWSER=$(_sc_select_browser) ; export BROWSER
EDITOR='vim' ; export EDITOR
LESS='-RXm' ; export LESS
SCM_EDITOR='viterm' ; export SCM_EDITOR

add_to_path_var()
{
    local varname="$1"
    local dirToAdd="$2"
    if [ ! -d "${dirToAdd}" ] ; then
        return 1
    fi
    eval local current=\$${varname}
    local newvalue=""
    if echo ":${current}:" | grep -q -s ":${dirToAdd}:" ; then
        return 0
    elif [ -n "${current}" ] ; then
        newvalue="${dirToAdd}:${current}"
    else
        newvalue="${dirToAdd}"
    fi
    eval ${varname}=\"${newvalue}\"
    return 0
}

add_to_path_var_and_export()
{
    local varname="$1"
    if add_to_path_var "$@" ; then
        export "${varname}"
    fi
}

if [ -z "${CDPATH}" ] ; then
    add_to_path_var CDPATH "/Users/Shared"
    add_to_path_var CDPATH "${HOME}"
    add_to_path_var CDPATH "${HOME}/repos"
fi

add_to_path_var MANPATH "$HOME/.local/share/man"

add_to_path_var PATH "/usr/local/opt/ruby/bin"
if [ -n "$(which ruby)" ] ; then
    add_to_path_var PATH "$(ruby -e 'puts Gem.bindir()')"
fi
add_to_path_var PATH "/Applications/SCM.app/Contents/Resources/scm/bin"
add_to_path_var PATH "${HOME}/Applications/SCM.app/Contents/Resources/scm/bin"
add_to_path_var PATH "/Users/Shared/tools/scripts"
add_to_path_var PATH "${HOME}/dotfiles/bin"
add_to_path_var PATH "${HOME}/bin"

add_to_path_var_and_export PYTHONPATH /Users/Shared/tools/libs/python
add_to_path_var_and_export RUBYLIB /Users/Shared/tools/libs/ruby
